<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AEO Snippet Optimizer â€” Smart SEO Insights</title>

  <!-- Tailwind CSS -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">

  <!-- Axios + jsPDF + XLSX + DOMPurify -->
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/2.4.0/purify.min.js"></script>
</head>

<body class="bg-gray-50 text-gray-900">

  <!-- Header -->
  <header class="bg-white shadow-md sticky top-0 z-50">
    <div class="max-w-6xl mx-auto px-6 py-4 flex items-center justify-between">
      <h1 class="text-2xl font-extrabold text-blue-700">AEO Snippet Optimizer</h1>
      <nav>
        <a href="#compare" class="text-gray-600 hover:text-blue-700 font-medium px-4">Compare</a>
        <a href="#about" class="text-gray-600 hover:text-blue-700 font-medium px-4">About</a>
      </nav>
    </div>
  </header>

  <!-- Hero -->
  <section class="text-center py-16 bg-gradient-to-br from-blue-50 to-indigo-100">
    <h2 class="text-4xl font-extrabold mb-4 text-gray-800">Boost Your SEO with AI-Powered Snippet Comparison</h2>
    <p class="text-gray-600 text-lg mb-8">Compare and optimize your Answer Engine Optimization (AEO) snippets using advanced AI insights.</p>
    <a href="#compare" class="bg-blue-700 hover:bg-blue-800 text-white font-semibold py-3 px-6 rounded-lg shadow-lg transition transform hover:-translate-y-1">Try Now â€” Itâ€™s Free!</a>
  </section>

  <!-- Comparison Tool -->
  <section id="compare" class="max-w-5xl mx-auto px-6 py-16">
    <h3 class="text-3xl font-bold text-center mb-10 text-gray-800">Compare Two Snippets Instantly</h3>

    <div class="grid md:grid-cols-2 gap-8 mb-8">
      <div>
        <label class="block text-sm font-semibold mb-2 text-gray-700">Snippet A</label>
        <textarea id="snippetA" class="w-full p-4 border rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 h-48 resize-none" placeholder="Paste your first snippet here..."></textarea>
      </div>
      <div>
        <label class="block text-sm font-semibold mb-2 text-gray-700">Snippet B</label>
        <textarea id="snippetB" class="w-full p-4 border rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 h-48 resize-none" placeholder="Paste your second snippet here..."></textarea>
      </div>
    </div>

    <div class="text-center">
      <button id="analyzeBtn" class="bg-blue-700 hover:bg-blue-800 text-white font-bold py-3 px-8 rounded-lg shadow-lg transition transform hover:-translate-y-1">
        Analyze with AI
      </button>
    </div>

    <!-- Loading Bar -->
    <div class="w-full bg-gray-200 h-2 mt-6 rounded-full overflow-hidden">
      <div id="loadingBar" class="h-2 bg-blue-600 w-0 transition-all duration-700"></div>
    </div>

    <!-- Results Section -->
    <div id="results" class="mt-10 bg-white rounded-xl shadow-lg p-8 hidden">
      <h4 class="text-2xl font-bold mb-4 text-blue-700">AI Comparative Analysis Result</h4>
      <div id="resultContent" class="whitespace-pre-wrap text-gray-800 leading-relaxed"></div>

      <!-- Download Buttons -->
      <div class="mt-6 flex flex-wrap gap-4 justify-center">
        <button id="downloadPdf" class="bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-5 rounded-lg shadow transition">ðŸ“„ Download PDF</button>
        <button id="downloadExcel" class="bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-5 rounded-lg shadow transition">ðŸ“Š Download Excel</button>
      </div>
    </div>
  </section>

  <!-- About -->
  <section id="about" class="bg-white py-16">
    <div class="max-w-5xl mx-auto px-6 text-center">
      <h3 class="text-3xl font-bold mb-4 text-gray-800">Why AEO Matters?</h3>
      <p class="text-gray-600 text-lg mb-6">Answer Engine Optimization helps your content stand out in AI-driven search results, voice assistants, and smart snippets.</p>
      <a href="https://developers.google.com/search/docs/fundamentals/seo-starter-guide" target="_blank" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg shadow-lg transition">Learn More About SEO</a>
    </div>
  </section>

  <!-- Footer -->
  <footer class="bg-gray-900 text-gray-300 text-center py-6">
    <p>Â© 2025 AEO Snippet Optimizer. All rights reserved.</p>
  </footer>

  <!-- âœ… Final JavaScript -->
  <script>
    const analyzeBtn = document.getElementById("analyzeBtn");
    const loadingBar = document.getElementById("loadingBar");
    const resultContent = document.getElementById("resultContent");
    const resultContainer = document.getElementById("results");

    function typeEffect(text, element, speed = 12) {
      element.textContent = "";
      let i = 0;
      function typing() {
        if (i < text.length) {
          element.textContent += text.charAt(i);
          i++;
          setTimeout(typing, speed);
        }
      }
      typing();
    }

    function showAIResult(payload) {
      if (!payload) {
        resultContent.textContent = "No response.";
        return;
      }
      resultContainer.classList.remove("hidden");

      if (payload.html && payload.html.trim().length > 0) {
        const clean = DOMPurify.sanitize(payload.html, {
          ALLOWED_TAGS: ['b','i','strong','em','p','ul','ol','li','table','thead','tbody','tr','th','td','br','h1','h2','h3','h4','div','span'],
          ALLOWED_ATTR: ['class','style']
        });
        resultContent.innerHTML = clean;
      } else if (payload.result && payload.result.trim().length > 0) {
        typeEffect(payload.result, resultContent, 8);
      } else {
        resultContent.textContent = "âš ï¸ No valid AI output received.";
      }
    }

    analyzeBtn.addEventListener("click", async () => {
      const snippetA = document.getElementById("snippetA").value.trim();
      const snippetB = document.getElementById("snippetB").value.trim();

      if (!snippetA || !snippetB) {
        alert("Please enter both snippets before analysis.");
        return;
      }

      resultContent.textContent = "";
      loadingBar.style.width = "0%";
      resultContainer.classList.add("hidden");
      setTimeout(() => { loadingBar.style.width = "70%"; }, 200);

      try {
        const res = await fetch("/api/analyze", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ snippetA, snippetB })
        });

        const data = await res.json();
        if (!res.ok || data.success === false) {
          showAIResult({ result: "âš ï¸ Error: " + (data.error || data.message || "Server error.") });
        } else {
          showAIResult(data);
        }
      } catch (err) {
        showAIResult({ result: "âš ï¸ Network error: " + err.message });
      } finally {
        loadingBar.style.width = "100%";
        setTimeout(() => { loadingBar.style.width = "0%"; }, 1000);
      }
    });

    // ðŸ“„ PDF Download
    document.getElementById("downloadPdf").addEventListener("click", () => {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({ unit: "pt", format: "a4" });
      const title = "AEO Snippet Optimizer â€” AI Report";
      const content = resultContent.innerText;
      const date = new Date().toLocaleString();

      doc.setFontSize(18);
      doc.text(title, 40, 50);
      doc.setFontSize(10);
      doc.text(`Generated on: ${date}`, 40, 70);
      const lines = doc.splitTextToSize(content, 520);
      doc.setFontSize(12);
      doc.text(lines, 40, 120);
      doc.save("AEO_Analysis_Report.pdf");
    });

    // ðŸ“Š Excel Download
    document.getElementById("downloadExcel").addEventListener("click", () => {
      const content = resultContent.innerText || "No result.";
      const ws = XLSX.utils.aoa_to_sheet([
        ["AEO Snippet Optimizer - Comparative Report"],
        ["Generated:", new Date().toLocaleString()],
        [""],
        [content]
      ]);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "AEO Analysis");
      XLSX.writeFile(wb, "AEO_Analysis_Report.xlsx");
    });
  </script>
</body>
</html>
